(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/home/salesBilling/salesBilling"],{"187a":function(e,t,i){"use strict";(function(e){i("2cfb");n(i("66fd"));var t=n(i("571e"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,i("543d")["createPage"])},1902:function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i={onLoad:function(e){e.book_order_ids&&(this.book_order_ids=JSON.parse(e.book_order_ids)),this.good_id=e.good_id||0,this.order_id=e.order_id||0;var t=new Date;this.toDay=this.http.dateFormat("YYYY-mm-dd",t),this.getInfo()},onShow:function(){var t=this;e.$on("chooseCustomer",(function(i){t.customer=i.item,t.getIntegralByCustomerId(i.item.id),e.$off("chooseCustomer")})),e.$on("salesGoods",(function(i){var n=t.goodsList.some((function(e){return e.id===i.item.id}));t.$set(i.item,"number",1),n||t.goodsList.push(i.item),e.$off("salesGoods")}))},computed:{totalPrice:function(){var e=0;return this.goodsList.forEach((function(t){e+=1e8*t.sell_price*t.number})),e/1e8},totalNumber:function(){var e=0;return this.goodsList.forEach((function(t){e+=t.number})),e},integral_yuan:function(){return this.integral/this.integral_rate}},data:function(){return{book_order_ids:[0],good_id:"",order_id:"",customer:{name:"",id:""},user_integral:0,integral:0,integral_on:0,integral_rate:1,settleWay:"",settleWay_id:"",showSettleList:!1,settleList:[],salesman:"",seller_id:"",showSalesmanList:!1,salesmanList:[],salesChannels:"",salesChannels_id:"",showSalesChannelsList:!1,salesChannelsList:[],delivery:"",delivery_id:"",showDeliveryList:!1,deliveryList:[],action:"/api/v1/Common/fileUploader",header:{Authorization:"Bearer "+this.http.getToken()},fileList:[],lists:[],showPri_img:!0,toDay:"",date:"",showDate:!1,edit_good_data:"",modalName:"",listTouchStart:0,listTouchDirection:null,goodsList:[],showTextArea:!1,textAreaValue:""}},methods:{getInfo:function(){var e=this;this.http.post("/api/v1/Order/getPreOrderInfo",{book_order_ids:this.book_order_ids,good_id:this.good_id||0,order_id:this.order_id||0},!0).then((function(t){1e3==t.code?(e.date=t.data.date,e.settleList=t.data.type_pay,e.salesmanList=t.data.seller,e.salesChannelsList=t.data.type_sale,e.deliveryList=t.data.type_send,e.edit_good_data=t.data.edit_good_data,e.integral_on=t.data.integral_on,e.integral_rate=Number(t.data.integral_rate),0!=e.good_id&&(e.goodsList=t.data.good_data.map((function(t){return e._formatData(t)}))),t.data.type_pay.map((function(i){i.id==t.data.type_pay_id&&(e.settleWay=i.val)})),e.settleWay_id=t.data.type_pay_id,t.data.seller.map((function(i){i.id==t.data.seller_id&&(e.salesman=i.name)})),e.seller_id=t.data.seller_id,0==e.order_id&&0==e.book_order_ids.length||(e.customer.id=t.data.customer_arr.customer_id,e.customer.name=t.data.customer_arr.customer_name,t.data.type_sale.map((function(i){i.id==t.data.type_sale_id&&(e.salesChannels=i.val)})),e.salesChannels_id=t.data.type_sale_id,t.data.type_send.map((function(i){i.id==t.data.type_send_id&&(e.delivery=i.val)})),e.delivery_id=t.data.type_send_id,2==e.delivery_id&&e.fileList.push({url:e.http.resourceUrl()+t.data.img_delivery,error:!1,progress:100}),e.textAreaValue=t.data.remark,e.goodsList=t.data.good_data.map((function(t){return e._formatData(t)})))):e.$refs.uToast.show({title:t.msg,type:"error",back:!0})}))},_formatData:function(e){return{pic:e.pic,title:e.good_name,num_now:e.num_now,id:e.id,sell_price:e.sell_price,date_in:e.created_at,store_no:e.store_no,number:e.buy_num||1}},getIntegralByCustomerId:function(e){var t=this;this.http.get("/api/v1/Common/getIntegralByCustomerId",{customer_id:e},!0).then((function(e){1e3==e.code&&(t.integral=e.data.integral)}))},chooseSettle:function(e){this.settleWay=e[0].label,this.settleWay_id=e[0].value},chooseSalesman:function(e){this.salesman=e[0].label,this.seller_id=e[0].value},chooseChannelsList:function(e){this.salesChannels=e[0].label,this.salesChannels_id=e[0].value},choosedDelivery:function(e){this.delivery=e[0].label,this.delivery_id=e[0].value},onListChange:function(e){console.log("onListChange",e),this.lists=e},dateChange:function(e){console.log(e),this.date=e.result},_formatGood:function(e){return{good_id:e.id,buy_num:e.number,sale_price:e.sell_price}},inputTextArea:function(){this.showTextArea=!0},hideTextArea:function(){this.showTextArea=!1},submit:function(){var t=this,i=this.goodsList.map((function(e){return t._formatGood(e)}));this.http.post("/api/v1/Order/createOrder",{book_order_ids:this.book_order_ids,customer_id:this.customer.id,seller_id:this.seller_id,type_pay:this.settleWay_id,type_sale:this.salesChannels_id,type_send:this.delivery_id,date:this.date,integral:this.user_integral||0,remark:this.textAreaValue,good_data:i,img_delivery:this.lists[0]&&this.lists[0].response.data.path||""}).then((function(i){1e3==i.code?(t.$refs.uToast.show({title:i.msg,type:"success",back:!0}),e.$emit("back",{back:!0})):t.$refs.uToast.show({title:i.msg,type:"error"})}))},setting:function(){var e=this,t=this.goodsList.map((function(t){return e._formatGood(t)}));console.log(this.lists),this.http.post("/api/v1/Order/editOrder",{order_id:this.order_id,customer_id:this.customer.id,seller_id:this.seller_id,type_pay:this.settleWay_id,type_sale:this.salesChannels_id,type_send:this.delivery_id,integral:this.user_integral||0,date:this.date,remark:this.textAreaValue,img_delivery:0!=this.lists.length?this.lists[0].response.data.path:"",good_data:t}).then((function(t){1e3==t.code?e.$refs.uToast.show({title:t.msg,type:"success",back:!0}):e.$refs.uToast.show({title:t.msg,type:"error"})}))},delet:function(e){if(0==this.edit_good_data)return this.$refs.uToast.show({title:"编辑时不可删除商品！",type:"error"});this.goodsList.splice(e,1)},ListTouchStart:function(e){this.listTouchStart=e.touches[0].pageX},ListTouchMove:function(e){this.listTouchDirection=e.touches[0].pageX-this.listTouchStart>0?"right":"left"},ListTouchEnd:function(e){"left"==this.listTouchDirection?this.modalName=e.currentTarget.dataset.target:this.modalName=null,this.listTouchDirection=null}}};t.default=i}).call(this,i("543d")["default"])},"3a01":function(e,t,i){"use strict";i.r(t);var n=i("1902"),o=i.n(n);for(var s in n)"default"!==s&&function(e){i.d(t,e,(function(){return n[e]}))}(s);t["default"]=o.a},"571e":function(e,t,i){"use strict";i.r(t);var n=i("af6e"),o=i("3a01");for(var s in o)"default"!==s&&function(e){i.d(t,e,(function(){return o[e]}))}(s);i("7a51");var a,r=i("f0c5"),u=Object(r["a"])(o["default"],n["b"],n["c"],!1,null,"09ebef07",null,!1,n["a"],a);t["default"]=u.exports},"76a3":function(e,t,i){},"7a51":function(e,t,i){"use strict";var n=i("76a3"),o=i.n(n);o.a},af6e:function(e,t,i){"use strict";i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return s})),i.d(t,"a",(function(){return n}));var n={uCellGroup:function(){return i.e("uview-ui/components/u-cell-group/u-cell-group").then(i.bind(null,"56bb"))},uCellItem:function(){return i.e("uview-ui/components/u-cell-item/u-cell-item").then(i.bind(null,"b9c3"))},uUpload:function(){return Promise.all([i.e("common/vendor"),i.e("uview-ui/components/u-upload/u-upload")]).then(i.bind(null,"c462"))},uIcon:function(){return i.e("uview-ui/components/u-icon/u-icon").then(i.bind(null,"0922"))},uImage:function(){return i.e("uview-ui/components/u-image/u-image").then(i.bind(null,"0e5c"))},uInput:function(){return Promise.all([i.e("common/vendor"),i.e("uview-ui/components/u-input/u-input")]).then(i.bind(null,"161c"))},uNumberBox:function(){return i.e("uview-ui/components/u-number-box/u-number-box").then(i.bind(null,"36f5"))},uGap:function(){return i.e("uview-ui/components/u-gap/u-gap").then(i.bind(null,"3be9"))},uToast:function(){return i.e("uview-ui/components/u-toast/u-toast").then(i.bind(null,"1922"))},uSelect:function(){return i.e("uview-ui/components/u-select/u-select").then(i.bind(null,"028a"))},uCalendar:function(){return i.e("uview-ui/components/u-calendar/u-calendar").then(i.bind(null,"6785"))}},o=function(){var e=this,t=e.$createElement,i=(e._self._c,2==e.delivery_id?e.http.interfaceUrl():null),n=0!=e.goodsList.length?e.http.resourceUrl():null;e._isMounted||(e.e0=function(t){e.showSettleList=!0},e.e1=function(t){e.showSalesmanList=!0},e.e2=function(t){e.showSalesChannelsList=!0},e.e3=function(t){e.showDeliveryList=!0},e.e4=function(t){e.showDate=!0}),e.$mp.data=Object.assign({},{$root:{g0:i,g1:n}})},s=[]}},[["187a","common/runtime","common/vendor"]]]);